{% extends 'user/basic.html' %}
{%block title%}Project-Hub - Projects Available{%endblock%}

{%block body%}
<div class="container">
    {% comment %} Alert Message Dialog Start {% endcomment %}
    {% if messages %}
        {% for message in messages %}
            <div {% if message.tags %} class="alert  my-1 border-{{ message.tags }} alert-dismissible fade show alert-{{ message.tags }} myAlert" {% endif %} role="alert" >
                <strong></strong> <b>{{ message}}</b>
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        {% endfor %}
    {% endif %}
    {% comment %} Alert Message Dialog Ends {% endcomment %}

   <div class="project-card-placeholder">
        {% for i in proj %}
        {% comment %} <div class="col"> {% endcomment %}
            <div class="card-pro">
                    <div class="photo">
                        <img src="/media/{{i.default_image}}" style="width: 100%; height: 100%; border-radius: 10px" >
                    </div>
                    <div class="description">
                        <h2>{{i.title}} {% if i.short_Desc %}<span> ( {{i.short_Desc}} )</span>{% endif %}</h2>
                        {% comment %} <h4>Popular House Plant</h4> {% endcomment %}
                        <h1>{% if  i.free %}
                            <span class="fw-semibold fs-5">Free</span>
                            <span class="text-decoration-line-through"> {{i.price}}0</span>
                        {% elif i.discounted_price %}
                            <span class="fw-semibold fs-5">₹ {{i.discounted_price}}0</span> 
                            <span class="text-decoration-line-through"> {{i.price}}0</span>
                        {%else%}
                            <span class="fw-semibold fs-5"> ₹ {{i.price}}0</span>
                        {%endif%}</h1>
                        <p>{{i.full_Desc| truncatechars:200}}</p>
                        <button id="addCartHandler">Add to Cart</button>
                        <button><a href="/projects/{{i.proj_id}}">View</a></button>
                    </div>
            </div>
        {% comment %} </div> {% endcomment %}
        {% endfor %}
    </div>
</div>

{%block JS%}
<script>
    // Getting the button and listening to clicks
    const addToCartBtn = document.getElementById("addCartHandler");

    addToCartBtn.addEventListener("click", ()=> {

        // Creating post form data to update cart
        let formData = new FormData();
        
        // Assining the price to post data, letter we need to encrypt this transmition
        {% csrf_token %}
            {% if  i.free %}
                formData.append("price", 0);
            {% elif i.discounted_price %}
                formData.append("price", {{i.discounted_price}});
            {%else%}
                formData.append("price", {{i.price}});
        {%endif%}

        let postData = {
            body: formData;
            method: "post"
        }
        // Sending request to server
        fetch("/handleAddToCart/{{i.proj_id}}", postData).then(res=>res.json()).then(data => {
            console.log(data);
        });
    });
    {% comment %} // /handleAddToCart/{{i.proj_id}} {% endcomment %}
</script>
{%endblock%}

{%endblock%}