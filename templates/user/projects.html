{% extends 'user/basic.html' %}
{%load static %}
{%block title%}Project-Hub - Projects Available{%endblock%}
{%block csslink%}
<link rel="stylesheet" href="{% static 'user/css/project-cards.css'%}" />
{%endblock%}

{%block body%}

    <div id="alert-section"></div> {% comment %} Alert Message Dialog{% endcomment %}

    <div class="project-card-placeholder">
        {% if src  %}
            {% if srcResult.count is 0 %}
                <div class="column m-4" style="color:black;">
                    <h2>No results found for : {{src_query}}</h2>
                    <h4>Suggestions:</h4>
                    <ul>
                        <li class="fw-semibold">Make sure that all words are spelled correctly.</li>
                        <li class="fw-semibold">Try different keywords.</li>
                        <li class="fw-semibold">Try more general keywords.</li>
                    </ul>
                    <a href="/" class=" btn btn-outline-dark"><b>Go to home</b></a>
                </div>
            {% else %}
            <h2 class="">Search results for : <em>{{src_query}}</em></h2><br>
                {% for i in srcResult %}
                    <!-- Products -->
                    <div class="bg-white rounded-lg shadow-md">
                        <a href="/projects/{{i.proj_id}}">
                            <img src="/media/{{i.default_image}}" alt="Product"
                                class="w-full h-64 object-cover rounded-t-lg">
                        </a>
                        <div class="p-4">
                            <h3 class="font-medium text-gray-900 mb-2"><a href="#">{{i.title}} {% if i.short_Desc %}<span> ( {{i.short_Desc}} )</span
                            >{% endif %}</a></h3>
                            <p class="text-gray-600 text-sm">{{i.full_Desc| truncatechars:130}}</p>
                            <div class="mt-4 flex justify-between items-center">
                                <span class="font-bold text-gray-900">
                                    
                                    {% if  i.free %}
                                        <span class="fw-semibold fs-5">Free</span>
                                        <span class="text-decoration-line-through"> {{i.price}}0</span>
                                        <input type="hidden" id="price" value="0"/>
                                        {% elif i.discounted_price %}
                                            <span class="fw-semibold fs-5">₹ {{i.discounted_price}}0</span> 
                                            <span class="text-decoration-line-through"> {{i.price}}0</span>
                                            <input type="hidden" id="price" value="{{i.discounted_price}}"/>
                                        {%else%}
                                            <span class="fw-semibold fs-5"> ₹ {{i.price}}0</span>
                                            <input type="hidden" id="price" value="{{i.price}}"/>
                                    {%endif%}

                                </span>
                                <input type="hidden" id="pro_id" value="{{i.proj_id}}"/>
                                <button class="bg-gray-800 text-white py-2 px-4 rounded hover:bg-gray-700" onclick="addToCart()">Add to
                                    Cart</button>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            {% endif %}
        {% else %}
            {% for i in proj %}
                <!-- Products -->
                <div class="bg-white rounded-lg shadow-md">
                    <a href="/projects/{{i.proj_id}}">
                        <img src="/media/{{i.default_image}}" alt="Product"
                            class="w-full h-64 object-cover rounded-t-lg">
                    </a>
                    <div class="p-4">
                        <h3 class="font-medium text-gray-900 mb-2"><a href="#">{{i.title}} {% if i.short_Desc %}<span> ( {{i.short_Desc}} )</span
                        >{% endif %}</a></h3>
                        <p class="text-gray-600 text-sm">{{i.full_Desc| truncatechars:130}}</p>
                        <div class="mt-4 flex justify-between items-center">
                            <span class="font-bold text-gray-900">
                                
                                {% if  i.free %}
                                    <span class="fw-semibold fs-5">Free</span>
                                    <span class="text-decoration-line-through"> {{i.price}}0</span>
                                    <input type="hidden" id="price" value="0"/>
                                    {% elif i.discounted_price %}
                                        <span class="fw-semibold fs-5">₹ {{i.discounted_price}}0</span> 
                                        <span class="text-decoration-line-through"> {{i.price}}0</span>
                                        <input type="hidden" id="price" value="{{i.discounted_price}}"/>
                                    {%else%}
                                        <span class="fw-semibold fs-5"> ₹ {{i.price}}0</span>
                                        <input type="hidden" id="price" value="{{i.price}}"/>
                                {%endif%}

                            </span>
                            <input type="hidden" id="pro_id" value="{{i.proj_id}}"/>
                            <button class="bg-gray-800 text-white py-2 px-4 rounded hover:bg-gray-700" onclick="addToCart()">Add to
                                Cart</button>
                        </div>
                    </div>
                </div>
            {% endfor %}
        {% endif %}
    </div>


{%block JS%}
<script>
    // Getting the button and listening to clicks
    {% comment %} const addToCartBtn = document.getElementById("addCartHandler"); {% endcomment %}


    function addToCart() {

        const amount = document.getElementById("price").value;
        const projectId = document.getElementById("pro_id").value;
        // Creating post form data to update cart
        let formData = new FormData();
        formData.append("csrfmiddlewaretoken", "{{ csrf_token }}")
        formData.append("price", amount)
        
        // Assining the price to post data, letter we need to encrypt this transmition

        let postData = {
            body: formData,
            method: "post",
        }
        // Sending request to server
        fetch("/handleAddToCart/"+projectId, postData).then(res=>res.json()).then(data => {
           
            document.getElementById("alert-section").innerHTML = `<div class="alert alert-${data.tag} alert-dismissible fade show" role="alert">
                ${data.msg}
                <button onclick="removeAlert()" type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>`;
            document.getElementById("cartCount").innerHTML= data.cartCount
            
            setTimeout(() => {
                document.getElementById("alert-section").innerHTML =""
            }, 5000);
  

        });
    }
    {% comment %} // /handleAddToCart/{{i.proj_id}} {% endcomment %}
    function removeAlert() {
        document.getElementById("alert-section").innerHTML ="";
      }
</script>
{%endblock%}

{%endblock%}